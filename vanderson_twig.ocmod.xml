<modification>
    <name>Twig Template Engine - OCMOD</name>
    <version>1.1</version>
    <author>Vanderson Lopes</author>
    <code>vanderson_twig_ocmod</code>

    <file path="system/engine/loader.php">
        <operation info="Twig Render">
            <search index="0">
                <![CDATA[public function view($template, $data = array()) {]]>
            </search>
            <add position="before">
                <![CDATA[
    // Twig for Opencart
    public function view($template, $data = array()) {
        if( ! $this->twig) {

            $this->library('twig');

            Twig_Autoloader::register();

            if(is_dir(DIR_TEMPLATE . $this->config->get('config_template') . '/template')) {
                $paths[] = DIR_TEMPLATE . $this->config->get('config_template') . '/template';
            }

            if(is_dir(DIR_TEMPLATE . 'default/template')) {
                $paths[] = DIR_TEMPLATE . 'default/template';
            }

            $paths[] = DIR_TEMPLATE;

            $loader = new Twig_Loader_Filesystem($paths);

            $cache = false;

            if(defined('TWIG_CACHE')) {
                $cache = TWIG_CACHE;
            }

            $this->twig = new Twig_Environment($loader,array(
                'autoescape' => false,
                'cache' => $cache
            ));
        }

        extract($data);
        ob_start();

        // First Step - Render Twig Native Templates
        $output = $this->twig->render($template, $data);

        // Second Step - IF template has PHP Syntax, then execute
        eval(' ?>' . $output);

        $output = ob_get_contents();

        ob_end_clean();

        return $output;
    }
]]>
            </add>
        </operation>
    </file> 
</modification>